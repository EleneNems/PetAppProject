<app-loading-spinner
  [loading]="loading"
  message="Loading Users...">
</app-loading-spinner>

<div class="container">
  
  <!-- Floating Decorative Animals -->
  <div class="deco-animals">
    <svg class="deco-bunny" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="50" cy="65" rx="25" ry="30" fill="var(--primary-pink)" opacity="0.15"/>
      <ellipse cx="35" cy="35" rx="8" ry="20" fill="var(--primary-pink)" opacity="0.15"/>
      <ellipse cx="65" cy="35" rx="8" ry="20" fill="var(--primary-pink)" opacity="0.15"/>
      <circle cx="45" cy="65" r="3" fill="var(--primary-pink)" opacity="0.2"/>
      <circle cx="55" cy="65" r="3" fill="var(--primary-pink)" opacity="0.2"/>
    </svg>
    
    <svg class="deco-cat" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="50" cy="60" rx="28" ry="25" fill="var(--secondary-cyan)" opacity="0.15"/>
      <path d="M 25 45 L 35 25 L 45 45 Z" fill="var(--secondary-cyan)" opacity="0.15"/>
      <path d="M 75 45 L 65 25 L 55 45 Z" fill="var(--secondary-cyan)" opacity="0.15"/>
      <circle cx="42" cy="58" r="3" fill="var(--secondary-cyan)" opacity="0.2"/>
      <circle cx="58" cy="58" r="3" fill="var(--secondary-cyan)" opacity="0.2"/>
    </svg>
    
    <svg class="deco-dog" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <ellipse cx="50" cy="60" rx="30" ry="28" fill="var(--accent-yellow)" opacity="0.15"/>
      <ellipse cx="30" cy="50" rx="12" ry="18" fill="var(--accent-yellow)" opacity="0.15"/>
      <ellipse cx="70" cy="50" rx="12" ry="18" fill="var(--accent-yellow)" opacity="0.15"/>
      <circle cx="43" cy="60" r="3" fill="var(--accent-yellow)" opacity="0.2"/>
      <circle cx="57" cy="60" r="3" fill="var(--accent-yellow)" opacity="0.2"/>
    </svg>
  </div>

  <div class="page-header">
    <div class="header-icon-wrapper">
      <svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
        <circle cx="30" cy="20" r="8" fill="none" stroke="var(--secondary-cyan)" stroke-width="2.5"/>
        <path d="M 15 45 Q 15 32 30 32 Q 45 32 45 45" fill="none" stroke="var(--secondary-cyan)" stroke-width="2.5"/>
        <circle cx="20" cy="25" r="5" fill="none" stroke="var(--primary-pink)" stroke-width="2" opacity="0.6"/>
        <circle cx="40" cy="25" r="5" fill="none" stroke="var(--primary-pink)" stroke-width="2" opacity="0.6"/>
      </svg>
      <div class="icon-glow"></div>
    </div>
    <h1 class="page-title">User Management</h1>
    <p>Manage user roles and permissions</p>
    
    <div class="subtitle-section">
      <div class="subtitle-line"></div>
      <p class="subtitle-text">Access Control</p>
      <div class="subtitle-line"></div>
    </div>
  </div>

  <!-- Message Alert -->
  <p *ngIf="message" class="message-alert" [class.success]="message.includes('now')">
    {{ message }}
  </p>

  <!-- Users Table Section -->
  <div class="users-section">
    <div class="section-header-admin">
      <div class="header-decoration-admin"></div>
      <h2>All Users</h2>
      <div class="header-decoration-admin"></div>
    </div>

    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="10" r="4" fill="none" stroke="var(--primary-pink)" stroke-width="2"/>
            <path d="M 6 20 Q 6 15 12 15 Q 18 15 18 20" fill="none" stroke="var(--primary-pink)" stroke-width="2"/>
          </svg>
        </div>
        <div class="stat-info">
          <div class="stat-number">{{ users.length }}</div>
          <div class="stat-label">Total Users</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M 12 2 L 15 8 L 22 9 L 17 14 L 18 21 L 12 18 L 6 21 L 7 14 L 2 9 L 9 8 Z" fill="none" stroke="var(--accent-yellow)" stroke-width="2"/>
          </svg>
        </div>
        <div class="stat-info">
          <div class="stat-number">{{ getAdminCount() }}</div>
          <div class="stat-label">Administrators</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" fill="none" stroke="var(--secondary-cyan)" stroke-width="2"/>
            <circle cx="12" cy="12" r="3" fill="var(--secondary-cyan)"/>
          </svg>
        </div>
        <div class="stat-info">
          <div class="stat-number">{{ getTotalCoins() }}</div>
          <div class="stat-label">Total Coins</div>
        </div>
      </div>
    </div>

    <!-- Desktop Table View -->
    <div class="table-container" *ngIf="users.length > 0">
      <table class="user-table">
        <thead>
          <tr>
            <th>
              <div class="th-content">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                  <path d="M 6 19 Q 6 16 12 16 Q 18 16 18 19" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
                Name
              </div>
            </th>
            <th>
              <div class="th-content">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <rect x="4" y="6" width="16" height="12" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
                  <path d="M 4 9 L 12 13 L 20 9" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
                Email
              </div>
            </th>
            <th>
              <div class="th-content">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M 12 2 L 15 8 L 22 9 L 17 14 L 18 21 L 12 18 L 6 21 L 7 14 L 2 9 L 9 8 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
                Role
              </div>
            </th>
            <th>
              <div class="th-content">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/>
                  <circle cx="12" cy="12" r="3" fill="currentColor"/>
                </svg>
                Coins
              </div>
            </th>
            <th>
              <div class="th-content">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="6" cy="12" r="2" fill="currentColor"/>
                  <circle cx="12" cy="12" r="2" fill="currentColor"/>
                  <circle cx="18" cy="12" r="2" fill="currentColor"/>
                </svg>
                Actions
              </div>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users" [class.current-user]="user.id === currentUserId">
            <td>
              <div class="user-name">
                <div class="user-avatar">
                  {{ user.name.charAt(0).toUpperCase() }}
                </div>
                <span>{{ user.name }}</span>
                <span *ngIf="user.id === currentUserId" class="badge-you">You</span>
              </div>
            </td>
            <td>
              <div class="user-email">{{ user.email }}</div>
            </td>
            <td>
              <span class="role-badge" [class.role-admin]="user.role === 'admin'" [class.role-user]="user.role === 'user'">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" *ngIf="user.role === 'admin'">
                  <path d="M 12 2 L 15 8 L 22 9 L 17 14 L 18 21 L 12 18 L 6 21 L 7 14 L 2 9 L 9 8 Z" fill="currentColor"/>
                </svg>
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" *ngIf="user.role === 'user'">
                  <circle cx="12" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                  <path d="M 6 19 Q 6 16 12 16 Q 18 16 18 19" fill="none" stroke="currentColor" stroke-width="2"/>
                </svg>
                {{ user.role }}
              </span>
            </td>
            <td>
              <div class="coins-display">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="12" cy="12" r="9" fill="none" stroke="var(--accent-yellow)" stroke-width="2"/>
                  <circle cx="12" cy="12" r="3" fill="var(--accent-yellow)"/>
                </svg>
                {{ user.coins }}
              </div>
            </td>
            <td>
              <button 
                (click)="confirmSwitchRole(user)" 
                [disabled]="user.id === currentUserId"
                [title]="user.id === currentUserId ? 'You cannot switch your own role' : 'Switch user role'"
                class="btn-action"
              >
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M 4 12 L 12 4 L 12 8 Q 18 8 18 14 Q 18 8 12 8 L 12 16 Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M 20 12 L 12 20 L 12 16 Q 6 16 6 10 Q 6 16 12 16 L 12 8 Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                Switch Role
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Mobile Card View -->
    <div class="mobile-user-cards" *ngIf="users.length > 0">
      <div class="user-card" *ngFor="let user of users" [class.current-user]="user.id === currentUserId">
        <div class="user-card-header">
          <div class="user-avatar-large">
            {{ user.name.charAt(0).toUpperCase() }}
          </div>
          <div class="user-card-info">
            <div class="user-card-name">
              {{ user.name }}
              <span *ngIf="user.id === currentUserId" class="badge-you">You</span>
            </div>
            <div class="user-card-email">{{ user.email }}</div>
          </div>
        </div>
        
        <div class="user-card-details">
          <div class="detail-row">
            <span class="detail-label">Role</span>
            <span class="role-badge" [class.role-admin]="user.role === 'admin'" [class.role-user]="user.role === 'user'">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" *ngIf="user.role === 'admin'">
                <path d="M 12 2 L 15 8 L 22 9 L 17 14 L 18 21 L 12 18 L 6 21 L 7 14 L 2 9 L 9 8 Z" fill="currentColor"/>
              </svg>
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" *ngIf="user.role === 'user'">
                <circle cx="12" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
                <path d="M 6 19 Q 6 16 12 16 Q 18 16 18 19" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
              {{ user.role }}
            </span>
          </div>
          
          <div class="detail-row">
            <span class="detail-label">Coins</span>
            <div class="coins-display">
              <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="9" fill="none" stroke="var(--accent-yellow)" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" fill="var(--accent-yellow)"/>
              </svg>
              {{ user.coins }}
            </div>
          </div>
        </div>
        
        <button 
          (click)="confirmSwitchRole(user)" 
          [disabled]="user.id === currentUserId"
          [title]="user.id === currentUserId ? 'You cannot switch your own role' : 'Switch user role'"
          class="btn-action full-width"
        >
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M 4 12 L 12 4 L 12 8 Q 18 8 18 14 Q 18 8 12 8 L 12 16 Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M 20 12 L 12 20 L 12 16 Q 6 16 6 10 Q 6 16 12 16 L 12 8 Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
          </svg>
          Switch Role
        </button>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="users.length === 0" class="empty-state">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <circle cx="50" cy="40" r="15" fill="none" stroke="var(--primary-pink)" stroke-width="3" opacity="0.3"/>
        <path d="M 25 75 Q 25 55 50 55 Q 75 55 75 75" fill="none" stroke="var(--primary-pink)" stroke-width="3" opacity="0.3"/>
      </svg>
      <h3>No Users Found</h3>
      <p>There are currently no users in the system.</p>
    </div>
  </div>

  <!-- Role Switch Modal -->
  <div class="modal-overlay" *ngIf="showModal">
    <div class="modal-window">
      <div class="modal-icon">
        <svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
          <path d="M 15 30 L 25 15 L 25 22 Q 35 22 35 32 Q 35 22 25 22 L 25 30 Z" fill="none" stroke="var(--secondary-cyan)" stroke-width="3" stroke-linejoin="round"/>
          <path d="M 45 30 L 35 45 L 35 38 Q 25 38 25 28 Q 25 38 35 38 L 35 30 Z" fill="none" stroke="var(--secondary-cyan)" stroke-width="3" stroke-linejoin="round"/>
        </svg>
      </div>
      <h3>Confirm Role Switch</h3>
      <p>Are you sure you want to switch the role for <strong class="highlight-name">{{ modalUser?.name }}</strong>?</p>
      <p class="role-change-info">
        Current role: <span class="role-badge-inline" [class.role-admin]="modalUser?.role === 'admin'" [class.role-user]="modalUser?.role === 'user'">{{ modalUser?.role }}</span>
        â†’
        New role: <span class="role-badge-inline" [class.role-admin]="modalUser?.role === 'user'" [class.role-user]="modalUser?.role === 'admin'">{{ modalUser?.role === 'admin' ? 'user' : 'admin' }}</span>
      </p>
      <div class="modal-buttons">
        <button (click)="switchRole()" class="btn btn-primary">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M 5 13 L 9 17 L 19 7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Yes, Switch
        </button>
        <button (click)="cancelModal()" class="btn btn-secondary">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M 6 6 L 18 18 M 18 6 L 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>